<!DOCTYPE html>
<html>
    <head>
        <title>Virtual Queue</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="header">Virtual Queue</div>
        <div id="main"></div>
        <script>
            // Password check

            const newQueueName = 'New Queue';
            let thisQueueName = '';
            const queues = [
                { 'name': 'RedHat',
                  'data': [ {
                    'name': 'Matthew Coffey',
                    'number': '555-123-4567'
                  }, {
                    'name': 'Chip Thrasher',
                    'number': '555-123-4561'
                  }, {
                    'name': 'Ashley John',
                    'number': '555-123-4562'
                  } ] }, 
                { 'name': 'NC State Career Development Center',
                  'data': [ ] }, 
                { 'name': 'NC State Engineer Your Experience',
                  'data': [ ] }, 
                { 'name': 'GE Vernova',
                  'data': [  ] }, 
                { 'name': 'AMD',
                  'data': [  ] }, 
                { 'name': 'NC State Career Development 2',
                  'data': [  ] }
            ];
            
            //
            // GUI/DOM functions.
            //

            // Populate #main with the menu screen.
            function showMenu() {
                // Update page title
                const header = document.getElementById('header');
                header.innerHTML = 'Virtual Queue';
                document.title = 'Virtual Queue';
                
                // Clear #main
                const main = document.getElementById('main');
                main.innerHTML = '';
                
                let content = '<div class="description">Choose a virtual queue.</div>';
                content += '<div class="menu" id="queues">';

                for(let queue of queues) {
                    // console.log('Queue name: ' + queue.name);
                    
                    content += '<button class="queue">' + queue.name + '</button>';
                }

                content += '</div>'; // End first menu
                content += '<div class="menu"><button class="queue opposite">' + newQueueName + '</button></div>'; // Second menu

                main.innerHTML = content;

                // Add event listeners
                addMenuListeners();
            }

            // Populate #main with a specified queue's view.
            function showQueue(queue) {
                if(queue == null || queue.name == '') {
                    throw("Trying to populate null/empty queue");
                }

                thisQueueName = queue.name;

                const header = document.getElementById('header');
                header.innerHTML = queue.name + '\'s Virtual Queue';
                document.title = queue.name + '\'s Virtual Queue';

                // Clear #main
                const main = document.getElementById('main');
                main.innerHTML = '';

                // Form (name, phone number, add button, pull button)
                let content = '';

                content += '<div class="form"><input type="text" placeholder="Name"><input type="tel" placeholder="Phone number">'
                content += '<button id="add">Add to Queue</button><button id="pull">Pull from Queue</button><button id="delete" class="opposite">Delete Queue</button></div>';

                // Next in line, empty queue div
                content += '<div class="description">Next in line:</div>';
                content += '<div id="queue"></div>';
                
                // Push out current DOM content
                main.innerHTML = content;
                    
                // Populate queue with the selected queue's data            
                populateQueue(queue.data);

                // Add event listeners
                addQueueListeners();
            }

            // Populate the queue list with data. 
            // Queue = array of {name, number} objects
            function populateQueue(queue) {
                const queueElement = document.getElementById('queue');
                let content = '';

                for(i = 0; i < queue.length; i++) {
                    let thisName = queue[i].name;
                    let thisNumber = queue[i].number;
                    
                    console.log(thisName, thisNumber);

                    content += `<div class="item" data-name="${thisName}" data-number="${thisNumber}">`;
                    content += `<span class="name">${thisName}</span>`;
                    content += `<span class="number">${thisNumber}</span>`;
                    content += '<span class="action">Delete</span></div>';
                }

                queueElement.innerHTML = content;
            }
        
            //
            // Queue manipulation functions. Interacts with data, minimal data validation.
            //
        
            // Remove an item from the queue.
            // Queue = the name of the queue to check
            // Name = the name to remove, optional
            // Returns the name of the person returned.
            function removeFromQueue(queue, name) {
                // If no queue, throw an error

                if(queue == null || queue == '') {
                    throw('Queue is null or not Object, cannot remove ' + name);
                }
                // If no name, remove the top item of the queue
                if(name == null || name == '') {

                }
                // If name, remove the specified item
            }

            // Add an item to the queue.
            // Queue = the queue to add to
            // Name = the name to add to queue
            // Number = the phone number to add to queue
            function addToQueue(queue, name, number) {
                // Don't verify, handle() functions worry about that.
            }

            // Add a new queue to the list.
            // Must check for duplicates and "New Queue".
            function newQueue() {
                let name = '', validName = false;
                while(name != null && validName == false) {
                    name = prompt('Name for the new queue:');
                    validName = true;

                    if(name.trim() == '') {
                        validName = false;
                        continue;
                    }
                    if(getQueueFromName(name)) {
                        validName = false;
                    }
                }
                queues.push({ 'name': name, 'data': [ ] });
                showMenu();
            }

            // Delete a queue with the specified name.
            function deleteQueue(name) {
                // Can't use getQueueFromName, we need an index.
                for(i = 0; i < queues.length; i++) {
                    if(queues[i].name.trim().toLowerCase() == name.trim().toLowerCase()) {
                        console.log('Matching queue name detected: ' + name);
                        queues.splice(i, 1);
                        break;
                    }
                }
            }

            // Helper function to get a queue object from its name.
            function getQueueFromName(name) {
                if(name == null || name == '') {
                    throw('Cannot getQueueFromName because name is null or empty');
                }
                for(let queue of queues) {
                    if(queue.name.trim().toLowerCase() == name.trim().toLowerCase()) {
                        return queue;
                    }
                }
                return null;
            }
            
            //
            // Main function & event listener setup functions. DOne for each view (menu, queue).
            //

            // Add event listeners to queue
            document.addEventListener('DOMContentLoaded', function() {
                showMenu();

                const header = document.getElementById('header');
                header.addEventListener('click', function() {
                    showMenu();
                });
            });
            

            // Add event listeners, after using showMenu().
            function addMenuListeners() {
                // console.log('Adding menu listeners');
                // Menu: queue buttons & New Queue button
                const queueElements = document.querySelectorAll('.queue');
                queueElements.forEach(function(element) {
                    // Handle queue selection with the given queue name
                    let name = element.innerHTML;
                    element.addEventListener('click', function() {
                        handleQueueSelection(name);
                    });
                });
            }

            // Add event listeners, after using showQueue().
            function addQueueListeners() {
                // Specific queue view: delete buttons, DeleteQueue, Add & Pull buttons
                const deleteButton = document.querySelector('#delete');
                deleteButton.addEventListener('click', function() {
                    // Find the name of the queue
                    handleDeleteQueue(thisQueueName);
                });

                const add = document.querySelector('#add');
                add.addEventListener('click', function() {
                    // Find the name of the queue

                    handleAddToQueue(thisQueueName, );
                });

                const pull = document.querySelector('#pull');
                pull.addEventListener('click', function() {
                    // Find the name of the queue
                    handlePullFromQueue(thisQueueName);
                });

                const deleteItemButtons = document.querySelectorAll('.action');
                deleteItemButtons.forEach(function(element) {
                    // Handle queue selection with the given queue name
                    let name = element.parentElement.getAttribute('data-name');
                    element.addEventListener('click', function() {
                        handleDeleteItem(name);
                    });
                });
            }

            //
            // Specific handler functions. Interact with GUI and provide data validation.
            //

            // Handle queue click from menu. "New Queue" (newQueueName) is an option
            function handleQueueSelection(name) {
                console.log('Click detected on ' + name + ', running handleQueueSelection');
                if(name == null || name == '') {
                    throw('handleQueueSelection called with null/empty name');
                }
                if(name == newQueueName) {
                    newQueue();
                }
                if(getQueueFromName(name)) {
                    showQueue(getQueueFromName(name));
                }
            }

            // Handle deleting a whole queue
            function handleDeleteQueue(name) {  
                // Null throws
                console.log("Handling delete queue");
                if(name == null || name == '') {
                    throw('handleDeleteQueue called with null/empty name');
                }
                // Are you sure? Type if so.
                let promptName = prompt('Do you really want to delete the queue? Type the queue name if so.');
                if(promptName.trim().toLowerCase() == name.trim().toLowerCase()) {
                    deleteQueue(name);
                    showMenu();
                }
            }

            // Handle delete click from queue
            function handleDeleteItem(name) {
                console.log('Trying to delete ' + name);
                // Are you sure?
                if(confirm('Do you really want to delete ' + name + ' from the queue?')) {
                    console.log(getQueueFromName(thisQueueName));
                    removeFromQueue(thisQueueName, name);
                    console.log(getQueueFromName(thisQueueName));
                    populateQueue(getQueueFromName(thisQueueName));
                    alert('Removed ' + name + ' from the queue.');
                }
            }

            // Handle Add button from queue
            function handleAddToQueue(queue, name, number) {
                // Verify form content
                console.log("Handling add to queue");
                addToQueue(queue, name, number);
            }
            
            // Handle Pull button from queue
            // Name = the queue name
            function handlePullFromQueue(queue) {
                // Check if queue can be pulled from
                
                // Are you sure?
                if(confirm('Do you really want to pull from the queue?')) {
                    let removedName = removeFromQueue(queue);
                    populateQueue();
                    alert('Removed ' + removedName + ' from the queue.');
                }
            }
        </script>
    </body>
</html>